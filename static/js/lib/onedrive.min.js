/*v4.2.7 Build 090515_1533 Minified 101015.201941*/
ï»¿var ROOTURL="https://api.onedrive.com/v1.0/drive/special/approot",token,mydata,mystatus,myxhr;function mkdir(dir,name,overwrite){if(dir!=""){dir=":/"+dir+":";}$.ajax({type:"POST",url:ROOTURL+dir+"/children"+"?access_token="+token,contentType:"application/json",data:JSON.stringify({"name":name,"folder":{},"@name.conflictBehavior":overwrite?"rename":"fail"}),statusCode:{409:function(){console.log("mkdir(): 409");}},success:function(data,status,xhr){$("#data").text(data);$("#status").text(status);$("#xhr").text(xhr);flag=true;}}).always(function(){console.log("Finished mkdir()");});}function ls(dir,detail){if(dir==undefined){dir="";}else if(dir&&dir!=""){dir=":/"+dir+"/:";}var array=[];$.ajax({type:"GET",dataType:"json",url:ROOTURL+dir+"?select=id,children&expand=children&access_token="+token,success:function(data,status,xhr){response=$.parseJSON(xhr.responseText);for(child in response["children"]){if(child){if(detail){array.push(response["children"][child]);}else{array.push(response["children"][child]["name"]);}}}console.log(array);}});}function cat(dir,name){console.log("Starting cat()");if(dir&&dir!=""){dir+="/";}$.ajax({type:"GET",url:"https://api.onedrive.com/v1.0/drive/root:/Apps/Journal/"+dir+name+":/content?access_token="+token,success:function(data,status,xhr){mydata=data;myxhr=xhr;console.log("\tcontentURL = "+xhr.responseText);console.log("Finished cat()");}});}function emacs(dir,name,content){console.log("Starting emacs()");if(dir==""){dir=":/";}else if(dir&&dir!=""){dir=":/"+dir+"/";}$.ajax({type:"PUT",url:ROOTURL+dir+name+":/content?access_token="+token,contentType:"text/plain",data:content,success:function(data,status,xhr){console.log("\txhr.responseText: "+xhr.responseText);console.log("Finished emacs()");}});}function cp(srcPath,srcName,desPath,desName){}function rm(dir,name){}function init(){}function downloadFile(){animation.log("Start downloading data..."); $("#download").html("&#xf1ce").addClass("spin").removeAttr("onclick").removeAttr("href");var id1=animation.blink("#download"); $("#refresh-media").hover(function(){var percent=parseInt(_.size(journal.archive.map)/journal.archive.media*100);if(isNaN(percent)){percent=0;}$(this).html(percent+"%");},function(){$(this).html("&#xf021");});var token=getTokenFromCookie();if(token!=""){ $.ajax({type:"GET",url:"https://api.onedrive.com/v1.0/drive/root:/Apps/Journal/data/data.js:/content?access_token="+token,}).done(function(data,status,xhr){window.app.dataLoaded=false;window.app.load("",true,xhr.responseText);animation.log("Text data fetched"); $.ajax({type:"GET",url:"https://api.onedrive.com/v1.0/drive/special/approot:/resource:?select=folder&access_token="+token}).done(function(data,status,xhr){ journal.archive.media=data["folder"]["childCount"];animation.log("Start downloading media data ...");downloadMedia();}).fail(function(xhr,status,error){animation.log("Cannot find the media data. The server returns error \""+error+"\"",true);});}).fail(function(xhr,status,error){animation.log("Cannot find any text data. The server returns error \""+error+"\"",true);}).always(function(){ clearInterval(id1); $("#download").html("&#xf0ed").attr("onclick","downloadFile()").attr("href","#");animation.finished("#download");});}}function downloadMedia(url){ if(url==undefined){ var token=getTokenFromCookie();journal.archive.map={};url="https://api.onedrive.com/v1.0/drive/special/approot:/resource:/children?select=name,size&access_token="+token;}$.ajax({type:"GET",url:url}).done(function(data,status,xhr){if(data["@odata.nextLink"]){downloadMedia(data["@odata.nextLink"]);}var itemList=data["value"];for(var key=0,len=itemList.length;key!=len;++key){var data={url:itemList[key]["@content.downloadUrl"],size:itemList[key]["size"]};journal.archive.map[itemList[key]["name"]]=data;} var finished=_.size(journal.archive.map);animation.log("Fetched "+finished+" of "+journal.archive.media);$("#refresh-media").css("background","-webkit-linear-gradient(top, #3f3f3f 0%,#3f3f3f "+finished/journal.archive.media*100+"%,#343434 0%,#343434 100%)");if(finished==journal.archive.media){ $("#refresh-media").html("&#xf021").removeClass("spin").css("background","").unbind("mouseenter mouseleave");animation.log("Media data fetched");animation.finished("#refresh-media");}});}function uploadFile(){animation.log("Start uploading ..."); $("#upload").html("&#xE10C").removeAttr("onclick").removeAttr("href");var id=animation.blink("#upload"),token=getTokenFromCookie(),d=new Date(),month=d.getMonth()+1,day=d.getDate(),year=d.getFullYear()%100,hour=d.getHours(),minute=d.getMinutes(),second=d.getSeconds();month=month<10?"0"+month:month;day=day<10?"0"+day:day;year=year<10?"0"+year:year;hour=hour<10?"0"+hour:hour;minute=minute<10?"0"+minute:minute;second=second<10?"0"+second:second;var fileName="data_"+month+day+year+"_"+hour+minute+second+".js",data={name:fileName}; $.ajax({type:"PATCH",url:"https://api.onedrive.com/v1.0/drive/special/approot:/data/data.js?access_token="+token,contentType:"application/json",data:JSON.stringify(data)}).done(function(){$("#upload").css("background","-webkit-linear-gradient(top, #3f3f3f 0%, #3f3f3f 50%, #343434 0%, #343434 100%)");animation.log("Data backup finished"); var tmp=edit.minData();$.ajax({type:"PUT",url:"https://api.onedrive.com/v1.0/drive/root:/Apps/Journal/data/data.js:/content?access_token="+token,contentType:"text/plain",data:JSON.stringify(tmp)}).done(function(data,status,xhr){animation.log("Data uploaded");}).fail(function(xhr,status,error){animation.log("Cannot upload data. Please try fixing the problem manually. The server returns error \""+error+"\"",true);});}).fail(function(xhr,status,error){animation.log("Cannot backup data. Please see if there is any name conflict. The server returns error \""+error+"\"",true);}).always(function(){ clearInterval(id); $("#upload").html("&#xE11C").css("background","").attr("onclick","uploadFile()").attr("href","#");animation.finished("#upload");});}function getCoverPhoto(selectorHeader,term,more,type){var id=animation.blink(selectorHeader+".thumb"),url="https://itunes.apple.com/search?output=json&lang=1&limit=1&media=music&entity=song,album,musicArtist&term=";if(typeof(type)=="number"){type=edit.mediaName(type);}if(type=="movie"){url="https://itunes.apple.com/search?output=json&lang=1&limit=1&media=movie&entity=movieArtist,movie&term=";}else if(type=="book"){url="https://itunes.apple.com/search?output=json&lang=1&limit=1&media=ebook&entity=ebook&term=";}$.ajax({url:url+term,dataType:"jsonp", success:function(response){var result=response.results[0];if(result==undefined){ animation.log("Cannot find matched result",true);animation.invalid(selectorHeader+"input");}else{ animation.log("Result found");var artist=result["artistName"],track=result["trackName"],coverUrl=result["artworkUrl100"];if(more){$(selectorHeader+".title").val(track);$(selectorHeader+".desc").val(artist);}$(selectorHeader+".thumb").attr("src",coverUrl);}clearInterval(id);}});}