var $jscomp={scope:{},checkStringArgs:function(a,d,b){if(null==a)throw new TypeError("The 'this' value for String.prototype."+b+" must not be null or undefined");if(d instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");return a+""}};
$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[d]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,d,b,c){if(d){b=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var e=a[c];e in b||(b[e]={});b=b[e]}a=a[a.length-1];c=b[a];d=d(c);d!=c&&null!=d&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:d})}};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,b){var c=$jscomp.checkStringArgs(this,a,"startsWith");a+="";for(var e=c.length,g=a.length,h=Math.max(0,Math.min(b|0,c.length)),f=0;f<g&&h<e;)if(c[h++]!=a[f++])return!1;return f>=g}},"es6-impl","es3");
function downloadFile(a){animation.log(log.CONTENTS_DOWNLOAD_START,1);$("#download").html("&#xf1ce").addClass("spin").removeAttr("onclick").removeAttr("href");$("#refresh-media").hover(function(){var a=parseInt(_.size(journal.archive.map)/journal.archive.media*100);isNaN(a)&&(a=0);$(this).html(a+"%")},function(){$(this).html("&#xf021")});getTokenCallback(function(d){""!=d&&(a=a||"https://api.onedrive.com/v1.0/drive/root:/Apps/Journal/core/data.js:/content?access_token="+d,$.ajax({type:"GET",url:a}).done(function(a,
c,e){window.app.dataLoaded=!1;window.addLoadDataWithFilter("",!0,e.responseText);animation.log(log.CONTENTS_DOWNLOAD_TEXT);$.ajax({type:"GET",url:"https://api.onedrive.com/v1.0/drive/special/approot:/resource:?select=folder&access_token="+d}).done(function(a,b,d){journal.archive.media=a.folder.childCount;animation.log(log.CONTENTS_DOWNLOAD_MEDIA_START,1);downloadMedia()}).fail(function(a,b,d){animation.error(log.CONTENTS_DOWNLOAD_MEDIA_FAIL+log.SERVER_RETURNS+d+log.SERVER_RETURNS_END,-1)})}).fail(function(a,
d,e){animation.error(log.CONTENTS_DOWNLOAD_TEXT_FAIL+log.SERVER_RETURNS+e+log.SERVER_RETURNS_END,-1)}).always(function(){$("#download").html("&#xf0ed").removeClass("spin").attr({onclick:"downloadFile()",href:"#"});animation.finished("#download");animation.log(log.CONTENTS_DOWNLOAD_END,-1)}))})}
function downloadMedia(a){void 0==a&&(a=getTokenFromCookie(),journal.archive.map={},a="https://api.onedrive.com/v1.0/drive/special/approot:/resource:/children?select=id,name,size,@content.downloadUrl&top=500&access_token="+a);$("#refresh-media").addClass("spin");$.ajax({type:"GET",url:a}).done(function(a,b,c){if(a["@odata.nextLink"]){b=a["@odata.nextLink"];b=b.split("&");for(c=0;c!==b.length;++c)if(b[c].startsWith("$select")){b[c]="$select=id,name,size,@content.downloadUrl";break}b=b.join("&");downloadMedia(b)}a=
a.value;b=0;for(c=a.length;b!=c;++b)journal.archive.map[a[b].name]={id:a[b].id,url:a[b]["@content.downloadUrl"],size:a[b].size};a=_.size(journal.archive.map);animation.log(log.CONTENTS_DOWNLOAD_MEDIA_LOADED+a+log.CONTENTS_DOWNLOAD_MEDIA_OF+journal.archive.media);$("#refresh-media").css("background","-webkit-linear-gradient(top, #3f3f3f 0%,#3f3f3f "+a/journal.archive.media*100+"%,#343434 0%,#343434 100%)");a==journal.archive.media&&($("#refresh-media").html("&#xf021").removeClass("spin").css("background",
"").unbind("mouseenter mouseleave"),animation.log(log.CONTENTS_DOWNLOAD_MEDIA_END,-1),animation.finished("#refresh-media"))})}
function getCoverPhoto(a,d,b,c){var e="https://itunes.apple.com/search?output=json&lang=1&limit=1&media=music&entity=song,album,musicArtist&term=";"number"==typeof c&&(c=edit.mediaName(c));"movie"==c?e="https://itunes.apple.com/search?output=json&lang=1&limit=1&media=movie&entity=movieArtist,movie&term=":"book"==c&&(e="https://itunes.apple.com/search?output=json&lang=1&limit=1&media=ebook&entity=ebook&term=");$.ajax({url:e+d,dataType:"jsonp",success:function(c){var d=c.results[0];if(void 0==d)animation.warn(log.COVER_PHOTO_FAIL),
animation.invalid(a+"input");else{animation.log(log.COVER_PHOTO_FOUND);c=d.artistName;var e=d.trackName,d=d.artworkUrl100;b&&($(a+".title").val(e),$(a+".desc").val(c));$(a+".thumb").attr("src",d)}}})}
function createFolder(a,d){getTokenCallback(function(b){$.ajax({type:"POST",url:"https://api.onedrive.com/v1.0/drive/root:/Apps/Journal/data:/children?access_token="+b,contentType:"application/json",data:JSON.stringify({name:a,folder:{}}),statusCode:{409:function(){edit.isFolder=!0;edit.folderDate=a}}}).done(function(){edit.isFolder=!0;edit.folderDate=a;animation.log(log.FOLDER_CREATED)}).always(function(){d(a)})})};
